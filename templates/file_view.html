{% extends 'base.html' %}

{% block content %}

<style>
    
    
    table {
        border-collapse: separate;
        border-spacing: 0 10px;
        width: 100%;
    }

    /* th {
        cursor: pointer;
        user-select: none;
    } */

    .sort-arrows {
        display: inline-flex;
        flex-direction: row;
        gap: 2px;
        font-size: 0.8em;
        vertical-align: middle;
    }

    .sort-arrow {
        font-size: 10px;
        color: gray;
        transition: color 0.3s ease;
        padding-left: 5px;
    }

    .sort-arrow:hover {
        color: white;
    }

    tbody tr:hover {
        background-color: #2d3748;
        cursor: pointer;
    }

    tbody tr td {
        padding-top: 15px;
        padding-bottom: 15px;
        padding-left: 10px;
        padding-right: 10px;
    }


    /* Ensure headers have the arrows inline */
    th .flex {
        display: flex;
        align-items: center;
        justify-content: flex-start;
    }

    /* Ensure arrows are aligned properly */
    th .sort-arrows {
        font-size: 0.75rem;
        margin-left: 0.25rem;
        cursor: pointer;
    }

    /* Truncate long text with ellipses */
    td {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 250px; /* Adjust the max-width as needed */
    }

    /* Optional: You can customize the appearance further */
    td .truncate {
        max-width: 250px; /* Adjust the max-width as needed */
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }


    .resizable {
    position: relative;
    cursor: col-resize;
}

.resize-handle {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 5px;
    cursor: col-resize;
    background-color: transparent;
}

.resizable:hover .resize-handle {
    background-color: rgba(255, 255, 255, 0.2);
}

</style>

<!-- Top Navbar -->
<nav class="bg-gray-800 sticky top-0 z-50 shadow-lg">
    <div class="max-w-7xl mx-auto">
        <div class="flex justify-between h-12">
            <div class="flex-shrink-0 flex items-center">
                <span class="text-2xl font-bold text-white">
                    AI File
                </span>
            </div>
            <div class="flex items-center">
                <a href="#" class="text-gray-300 hover:text-white px-4 py-2 rounded-md font-normal" style="font-size: 15px;">
                    Dashboard
                </a>
                <a href="#" class="text-gray-300 hover:text-white px-4 py-2 rounded-md font-normal" style="font-size: 15px;">
                    Settings
                </a>
                <a href="#" class="text-gray-300 hover:text-white px-4 py-2 rounded-md font-normal" style="font-size: 15px;">
                    Logout
                </a>
            </div>
        </div>
    </div>
    <hr class="border-gray-700">
</nav>

<!-- Main -->
<div class="flex">
    
    <!-- Vertical Navbar -->
    <aside class="bg-gray-800 w-56 sticky top-16 h-screen p-4 py-6">
        <nav class="space-y-4">
            <a href="#" class="text-base font-medium text-gray-300 hover:text-white flex items-center">
                <svg class="h-6 w-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m2 12H7a2 2 0 01-2-2V6a2 2 0 012-2h5.4a2 2 0 011.6.8l2.4 2.9a2 2 0 001.6.8H19a2 2 0 012 2v11a2 2 0 01-2 2z"></path></svg>
                All Files
            </a>
            <a href="#" class="text-base font-medium text-gray-300 hover:text-white flex items-center">
                <svg class="h-6 w-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7a4 4 0 014-4h10a4 4 0 014 4v10a4 4 0 01-4 4H7a4 4 0 01-4-4V7z"></path></svg>
                Documents
            </a>
            <a href="#" class="text-base font-medium text-gray-300 hover:text-white flex items-center">
                <svg class="h-6 w-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12 7-12 6z"></path></svg>
                Media Files
            </a>
            <a href="#" class="text-base font-medium text-gray-300 hover:text-white flex items-center">
                <svg class="h-6 w-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h14a1 1 0 011 1v16a1 1 0 01-1 1H4a1 1 0 01-1-1V4z"></path></svg>
                Code Files
            </a>
            <a href="#" class="text-base font-medium text-gray-300 hover:text-white flex items-center">
                <svg class="h-6 w-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v8m4-4H8"></path></svg>
                Others
            </a>
        </nav>
        <hr class="border-gray-700 mt-4">
    </aside>

    <main class="flex-1 p-6 px-8">

        <!-- Search Bar -->
        <!-- <div class="mb-6 flex justify-center">
            <input 
                type="text" 
                placeholder="Search..." 
                class="w-1/3 p-2 px-3 rounded-lg bg-gray-800 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
                style="background-color: rgb(55 65 81);"
            >
            <button 
                type="button" 
                class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg px-5 ml-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800"
            >Search</button>
        </div> -->

        <div class="mb-6 flex justify-center">
            <input 
                type="text"
                placeholder="Coming soon..."
                class="w-1/3 p-2 px-3 rounded-lg bg-gray-700 border border-gray-600 text-gray-400 cursor-not-allowed"
                style="background-color: rgb(55 65 81);"
                disabled
            >
            <button 
                type="button"
                class="text-gray-400 bg-blue-600 cursor-not-allowed font-medium rounded-lg px-5 ml-2"
                disabled
            >
                Search
            </button>
        </div>


        <div class="flex items-center justify-between mb-4">
            <h3 class="text-2xl font-bold">
                Categories
            </h3>
        
            <!-- Dropdown Menu -->
            <div class="relative">
                <button id="viewDropdown" class="bg-gray-800 text-white font-semibold py-2 px-4 rounded inline-flex items-center focus:outline-none">
                    <span>View by: Entity</span>
                    <svg class="fill-current h-4 w-4 ml-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <path d="M0 0h20v20H0z" fill="none"/>
                        <path d="M10 12l-4-4h8l-4 4z"/>
                    </svg>
                </button>
                <ul id="viewDropdownMenu" class="absolute hidden text-gray-200 bg-gray-800 rounded-lg shadow-lg mt-1 right-0 w-40 z-10">
                    <li class="hover:bg-gray-700 cursor-pointer px-4 py-2">Entity</li>
                    <li class="hover:bg-gray-700 cursor-pointer px-4 py-2">Sub-categories</li>
                </ul>
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="category-list">
            {% for l in categorized_files %}
                <div class="bg-gray-800 p-4 rounded-lg shadow-lg hover:bg-gray-700 cursor-pointer category-card" data-category="{{ l.0 }}">
                    <h2 class="text-xl font-bold mb-2">
                        {{ l.0 }}
                    </h2>
                    <p class="text-gray-400">{{ l.1|length }} Files</p>
                </div>
            {% endfor %}
        </div>


        <!-- <h3 class="text-2xl font-bold mb-4">
            Categories
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="category-list">

            {% for l in categorized_files %}

                <div class="bg-gray-800 p-4 rounded-lg shadow-lg hover:bg-gray-700 cursor-pointer category-card" data-category="{{ l.0 }}">                    
                    <h2 class="text-xl font-bold mb-2">
                        {{ l.0 }}
                    </h2>
                    <p class="text-gray-400">{{ l.1|length }} Files</p>
                </div>

            {% endfor %}

        </div> -->


        <!-- <div class="mt-8">
            <h3 id="recent-files-header" class="text-2xl font-bold mb-4">
                Recent Files
            </h3>

            <div class="mb-8">
                <div class="flex justify-between items-center">
                    <h2 class="text-lg font-semibold">Files</h2>
                    <a href="#" class="text-blue-400">View All</a>
                </div>
                <div class="bg-gray-800 rounded-lg mt-4">

                    <div class="overflow-x-auto">
                        <table class="min-w-full table-auto" id="file-table">
                            <thead>
                                <tr>
                                    <th class="resizable px-4 py-2 text-left text-base font-semibold text-gray-400">
                                        Name
                                        <span class="sort-arrows">
                                            <span class="sort-arrow" data-order="asc">▲</span>
                                            <span class="sort-arrow" data-order="desc">▼</span>
                                        </span>
                                    </th>
                                    <th class="px-4 py-2 text-left text-base font-semibold text-gray-400">
                                        Type 
                                        <span class="sort-arrows">
                                            <span class="sort-arrow" data-order="asc">▲</span>
                                            <span class="sort-arrow" data-order="desc">▼</span>
                                        </span>
                                    </th>
                                    <th class="px-4 py-2 text-left text-base font-semibold text-gray-400">
                                        Size 
                                        <span class="sort-arrows">
                                            <span class="sort-arrow" data-order="asc">▲</span>
                                            <span class="sort-arrow" data-order="desc">▼</span>
                                        </span>
                                    </th>
                                    <th class="px-4 py-2 text-left text-base font-semibold text-gray-400">
                                        Last Modified
                                        <span class="sort-arrows">
                                            <span class="sort-arrow" data-order="asc">▲</span>
                                            <span class="sort-arrow" data-order="desc">▼</span>
                                        </span>
                                    </th>
                                    <th class="px-4 py-2 text-left text-base font-semibold text-gray-400">
                                        Sub Categories
                                        <span class="sort-arrows">
                                            <span class="sort-arrow" data-order="asc">▲</span>
                                            <span class="sort-arrow" data-order="desc">▼</span>
                                        </span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-gray-800">
                                <tr>
                                    <td class="resizable px-4 py-2 text-sm text-gray-300">Project_Plan.docx</td>
                                    <td class="px-4 py-2 text-sm text-gray-300">Document</td>
                                    <td class="px-4 py-2 text-sm text-gray-300">1.2 MB</td>
                                    <td class="px-4 py-2 text-sm text-gray-300">2024-07-28</td>
                                    <td class="px-4 py-2 text-sm text-gray-300">Work, Planning</td>
                                </tr>
                                <tr>
                                    <td class="resizable px-4 py-2 text-sm text-gray-300">Logo_Design.png</td>
                                    <td class="px-4 py-2 text-sm text-gray-300">Image</td>
                                    <td class="px-4 py-2 text-sm text-gray-300">3.4 MB</td>
                                    <td class="px-4 py-2 text-sm text-gray-300">2024-08-01</td>
                                    <td class="px-4 py-2 text-sm text-gray-300">Branding, Design</td>
                                </tr>
                                <tr>
                                    <td class="resizable px-4 py-2 text-sm text-gray-300">Music_Track.mp3</td>
                                    <td class="px-4 py-2 text-sm text-gray-300">Audio</td>
                                    <td class="px-4 py-2 text-sm text-gray-300">7.5 MB</td>
                                    <td class="px-4 py-2 text-sm text-gray-300">2024-07-25</td>
                                    <td class="px-4 py-2 text-sm text-gray-300">Entertainment, Audio</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>

        </div> -->

    </main>

</div>

<input type="hidden" value="{{ sorted_list_json }}" id="categorized_file_input"/>


<script>
    // Get the categorized files from the hidden input
    let sorted_file_list = JSON.parse(document.getElementById('categorized_file_input').value);
    console.log('slist:', sorted_file_list);

    let file_category_dict = {};
    for (let i = 0; i < sorted_file_list.length; i++) {
        let sub_list = sorted_file_list[i];
        file_category_dict[sub_list[0]] = sub_list[1];
    }
    console.log('ctg-dict:', file_category_dict);

    // Function to render files in the table based on the selected category
    function renderFiles(category) {
        
        document.getElementById('recent-files-header').textContent = category + " Files";
        
        const category_files = file_category_dict[category];
        const tbody = document.querySelector('#file-table tbody');
        tbody.innerHTML = ''; // Clear any existing rows

        if (category_files) {
            category_files.forEach(file => {
                console.log('file-info:', file);
                const row = document.createElement('tr');

                // Create badges for sub-categories
                const subCategories = file['sub_categories'].map(subCategory => `
                    <span class="inline-block bg-gray-700 text-gray-300 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded">${subCategory}</span>
                `).join('');
                // <td class="px-4 py-2 text-left text-base text-gray-400">${file['sub_categories']}</td>

                // row.innerHTML = `
                //     <td class="px-4 py-2 text-left text-base text-gray-400">${file['file_name']}</td>
                //     <td class="px-4 py-2 text-left text-base text-gray-400">${file['entity_type']}</td>
                //     <td class="px-4 py-2 text-left text-base text-gray-400">${file['file_size_string']}</td>
                //     <td class="px-4 py-2 text-left text-base text-gray-400">${file['file_modified_at_date_time']}</td>
                //     <td class="px-4 py-2 text-left text-base text-gray-400">${subCategories}</td>
                // `;

                row.innerHTML = `
                    <td class="px-4 py-2 text-left text-base text-gray-400 truncate">${file['file_name']}</td>
                    <td class="px-4 py-2 text-left text-base text-gray-400">${file['entity_type']}</td>
                    <td class="px-4 py-2 text-left text-base text-gray-400">${file['file_size_string']}</td>
                    <td class="px-4 py-2 text-left text-base text-gray-400">${file['file_modified_at_date_time']}</td>
                    <td class="px-4 py-2 text-left text-base text-gray-400">${subCategories}</td>
                `;
                tbody.appendChild(row);
            });
        }
    }

    // Add click event listeners to each category card
    document.querySelectorAll('.category-card').forEach(card => {
        card.addEventListener('click', function() {
            const category = this.dataset.category;
            renderFiles(category);
        });
    });

    // Sorting functionality
    document.querySelectorAll('.sort-arrow').forEach(function(arrow) {
        arrow.addEventListener('click', function() {
            var order = this.getAttribute('data-order');
            var column = this.closest('th').textContent.trim();
            var tbody = this.closest('table').querySelector('tbody');
            var rows = Array.from(tbody.querySelectorAll('tr'));

            // Determine the column index
            var columnIndex = Array.from(this.closest('tr').children).indexOf(this.closest('th'));

            // Sort rows based on the column and order
            rows.sort(function(a, b) {
                var cellA = a.children[columnIndex].textContent.trim();
                var cellB = b.children[columnIndex].textContent.trim();

                if (order === 'asc') {
                    return cellA.localeCompare(cellB, undefined, {numeric: true, sensitivity: 'base'});
                } else {
                    return cellB.localeCompare(cellA, undefined, {numeric: true, sensitivity: 'base'});
                }
            });

            // Reorder rows
            rows.forEach(function(row) {
                tbody.appendChild(row);
            });
        });
    });


    document.querySelectorAll('.resizable').forEach(function (cell) {
        const resizeHandle = document.createElement('div');
        resizeHandle.className = 'resize-handle';
        cell.appendChild(resizeHandle);

        let startX, startWidth;

        resizeHandle.addEventListener('mousedown', function (e) {
            startX = e.pageX;
            startWidth = parseInt(document.defaultView.getComputedStyle(cell).width, 10);
            document.documentElement.addEventListener('mousemove', doDrag, false);
            document.documentElement.addEventListener('mouseup', stopDrag, false);
        });

        function doDrag(e) {
            const th = cell.closest('table').querySelector('th.resizable');
            th.style.width = (startWidth + e.pageX - startX) + 'px';
            document.querySelectorAll('td.resizable').forEach(function (td) {
                td.style.width = (startWidth + e.pageX - startX) + 'px';
            });
        }

        function stopDrag() {
            document.documentElement.removeEventListener('mousemove', doDrag, false);
            document.documentElement.removeEventListener('mouseup', stopDrag, false);
        }
    });


    document.getElementById('viewDropdown').addEventListener('click', function () {
        const menu = document.getElementById('viewDropdownMenu');
        menu.classList.toggle('hidden');
    });

    document.querySelectorAll('#viewDropdownMenu li').forEach(item => {
        item.addEventListener('click', function () {
            // const dropdownText = document.querySelector('#viewDropdown span');
            // dropdownText.textContent = 'View by: ' + this.textContent;
            
            // // Add your logic to filter or change the view here.
            // // For example, you could add a class or attribute to category-list 
            // // and apply the filter via CSS or JS.
            
            // // Hide the menu after selection
            // document.getElementById('viewDropdownMenu').classList.add('hidden');

            // TODO: go from here to implementing the dropdown selection with the cards changing;
            const dropdownText = document.querySelector('#viewDropdown span');
            const selectedView = this.textContent;
            dropdownText.textContent = 'View by: ' + selectedView;

            // Change the h3 title based on the dropdown selection
            const categoriesTitle = document.getElementById('categories-title');
            categoriesTitle.textContent = selectedView + ' Categories';

            // Hide the menu after selection
            document.getElementById('viewDropdownMenu').classList.add('hidden');

            // Additional logic can be added here to update the category view

        });
    });





    // let file_category_dict = {};
    // for (i=0; i<=sorted_file_list.length-1; i++){
    //     let sub_list = sorted_file_list[i];
    //     file_category_dict[sub_list[0]] = sub_list[1];
    // }
    // console.log('ctg-dict:', file_category_dict);

    // // Function to render files in the "Recent Files" section
    // function renderFiles(category) {

    //     const category_files = file_category_dict[category];

    //     document.getElementById('recent-files-header').textContent = category + " Files";
    //     const fileList = document.getElementById('recent-files-list');
    //     fileList.innerHTML = ''; // Clear any existing files

    //     if (category_files) {
    //         // const files = categoryData[1]; // Array of file objects
    //         category_files.forEach(file => {
    //             console.log('file-info:', file)
    //             const fileElement = document.createElement('li');
    //             fileElement.className = 'bg-gray-800 p-3 rounded-lg shadow-md flex justify-between items-center';
    //             fileElement.innerHTML = `
    //                 <span>${file['entity_type']}</span>
    //                 <span class="text-gray-400">temp</span>
    //             `;
    //             fileList.appendChild(fileElement);
    //         });
    //     }

    //     // // Find the category in the sorted_file_list
    //     // const categoryData = sorted_file_list.find(item => item[0] === category);

    //     // // Update the header to the selected category
    //     // document.getElementById('recent-files-header').textContent = category;

    //     // // Get the file list element
    //     // const fileList = document.getElementById('recent-files-list');
    //     // fileList.innerHTML = ''; // Clear any existing files

    //     // // If the category was found, populate the files
    //     // if (categoryData) {
    //     //     const files = categoryData[1]; // Array of file objects
    //     //     files.forEach(file => {
    //     //         const fileElement = document.createElement('li');
    //     //         fileElement.className = 'bg-gray-800 p-3 rounded-lg shadow-md flex justify-between items-center';
    //     //         fileElement.innerHTML = `
    //     //             <span>${file.entity_type}</span>
    //     //             <span class="text-gray-400">${file.primary_key}</span>
    //     //         `;
    //     //         fileList.appendChild(fileElement);
    //     //     });
    //     // }
    // }

    // // Add click event listeners to each category card
    // document.querySelectorAll('.category-card').forEach(card => {
    //     card.addEventListener('click', function() {
    //         const category = this.dataset.category;
    //         renderFiles(category);
    //     });
    // });


    // // Sorting functionality
    // document.querySelectorAll('.sort-arrow').forEach(function(arrow) {
    //     arrow.addEventListener('click', function() {
    //         var order = this.getAttribute('data-order');
    //         var column = this.closest('th').textContent.trim();
    //         var tbody = this.closest('table').querySelector('tbody');
    //         var rows = Array.from(tbody.querySelectorAll('tr'));

    //         // Determine the column index
    //         var columnIndex = Array.from(this.closest('tr').children).indexOf(this.closest('th'));

    //         // Sort rows based on the column and order
    //         rows.sort(function(a, b) {
    //             var cellA = a.children[columnIndex].textContent.trim();
    //             var cellB = b.children[columnIndex].textContent.trim();

    //             if (order === 'asc') {
    //                 return cellA.localeCompare(cellB, undefined, {numeric: true, sensitivity: 'base'});
    //             } else {
    //                 return cellB.localeCompare(cellA, undefined, {numeric: true, sensitivity: 'base'});
    //             }
    //         });

    //         // Reorder rows
    //         rows.forEach(function(row) {
    //             tbody.appendChild(row);
    //         });
    //     });
    // });

</script>

{% endblock %}