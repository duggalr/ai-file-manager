{% extends 'base.html' %}

{% block content %}

<div class="w-full max-w-md mx-auto p-6 bg-gray-800 rounded-lg shadow-md">
    <h2 class="text-2xl font-semibold text-gray-100 text-center">
        Enter File Path
    </h2>

    <form id="uploadForm" class="mt-6">
        <div class="mb-4">
            <label class="block text-gray-400 text-sm font-bold mb-2" for="directoryInput">
                Directory Filepath:
            </label>
            <div class="flex">
                <input 
                    type="text" 
                    id="directory_path_input" 
                    name="directory_path" 
                    placeholder="Enter a directory path" 
                    class="w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm bg-gray-700 text-gray-300 focus:outline-none focus:ring focus:border-blue-500" 
                    required
                >
            </div>
        </div>

        <div id="loader" class="fixed top-0 left-0 w-screen h-screen flex items-center justify-center bg-gray-900 bg-opacity-50 z-50 hidden">
            <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-gray-100"></div>
        </div>

        <button 
            type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md focus:outline-none focus:ring focus:border-blue-500"
        >
            Organize
        </button>
    </form>

    <div id="responseMessage" class="mt-4 hidden p-3 text-center"></div>
</div>

<script>

    document.getElementById('uploadForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const filePath = document.getElementById('directory_path_input').value;
        console.log('fp:', filePath);

        $('#loader').removeClass('hidden');

        $.ajax({
            url: "{% url 'handle_user_file_path_submit' %}",
            type: "POST",
            dataType: "json",
            data: {
                user_file_path: filePath,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: (data) => {
                // console.log(data);
                $('#loader').hide();
                if (data['success'] === true){
                    window.location.href = '/file-view';
                }
            },
            error: (error) => {
                console.log(error);
            }
        });

    });

</script>

{% endblock %}
